<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBITS Playground - Dashboard</title>
    
    <!-- Estilos locales -->
    <link rel="stylesheet" href="ubits-colors.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="fontawesome-icons.css">
    <link rel="stylesheet" href="ubits-typography.css">
    <link rel="stylesheet" href="components/sub-nav.css">
    <link rel="stylesheet" href="components-sidebar.css">
    <link rel="stylesheet" href="components/tab-bar.css">
    <link rel="stylesheet" href="components/floating-menu.css">
    <link rel="stylesheet" href="components/profile-menu.css">
    <link rel="stylesheet" href="components/button.css">
    <link rel="stylesheet" href="profile.css">
    <style>
        /* ===== SISTEMA DE ONBOARDING NUEVO ===== */
        
        /* Overlay principal */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .onboarding-overlay.show {
            display: block;
            opacity: 1;
        }
        
        /* Spotlight para destacar elementos */
        .onboarding-spotlight {
            position: fixed;
            border: 3px solid #667eea;
            border-radius: 8px;
            background: rgba(102, 126, 234, 0.1);
            z-index: 10001;
            pointer-events: none;
            display: none;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
        }
        
        /* Tooltip de instrucciones */
        .onboarding-tooltip {
            position: fixed;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 10002;
            max-width: 400px;
            font-family: 'Noto Sans', sans-serif;
        }
        
        .tooltip-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .tooltip-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
            color: white;
        }
        
        .tooltip-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin: 0;
        }
        
        .tooltip-content {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .tooltip-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .tooltip-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tooltip-button.secondary {
            background: white;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }
        
        .tooltip-button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* Botón de feedback flotante */
        .feedback-trigger {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .feedback-trigger:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.6), 0 0 0 10px rgba(102, 126, 234, 0.1); }
            100% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3); }
        }
        
        /* ¡A LA MIERDA LAS REGLAS PENDEJAS! */

        /* Custom Select Styles - Exactamente iguales a la página emocional */
        .filter-group {
            margin-bottom: 24px;
        }

        .filter-group label {
            font-weight: 500;
            color: #4a5568;
            margin-right: 8px;
        }

        .custom-select {
            position: relative;
            min-width: 200px;
        }

        .custom-select select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #2d3748;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 8px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 32px;
        }

        .custom-select select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Tabla de encuestas */
        .surveys-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .surveys-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 1px solid #e2e8f0;
        }

        .surveys-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            color: #4a5568;
        }

        .surveys-table tr:hover {
            background: #f8fafc;
        }

        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .clickable-row:hover {
            background: #f0f4f8 !important;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body data-theme="light">
    <!-- ===== SISTEMA DE ONBOARDING NUEVO ===== -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <div class="onboarding-spotlight" id="onboardingSpotlight"></div>
        <div class="onboarding-tooltip" id="onboardingTooltip">
            <div class="tooltip-header">
                <div class="tooltip-icon" id="tooltipIcon">🎯</div>
                <h3 class="tooltip-title" id="tooltipTitle">Paso 1</h3>
            </div>
            <div class="tooltip-content" id="tooltipContent">
                Contenido del paso
            </div>
            <div class="tooltip-actions">
                <button class="tooltip-button secondary" onclick="skipOnboarding()" id="tooltipSkipBtn">Omitir</button>
                <button class="tooltip-button primary" onclick="nextOnboardingStep()" id="tooltipNextBtn">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- ===== BOTÓN DE FEEDBACK FLOTANTE ===== -->
    <div class="feedback-trigger" id="feedbackTrigger" onclick="openFeedbackModal()">
        💬
    </div>

    <div class="dashboard-container">
        <div class="tooltip" id="tooltip"></div>
        
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Tab Bar Container -->
            <div id="tab-bar-container"></div>

            <!-- Content Area -->
            <div class="content-area">
                <div class="page-header">
                    <h1>Encuestas</h1>
                    <p>Gestiona y monitorea todas tus encuestas NOM-035</p>
                </div>

                <!-- Filtros -->
                <div class="filter-group">
                    <label for="status-filter">Estado:</label>
                    <div class="custom-select">
                        <select id="status-filter">
                            <option value="">Todos</option>
                            <option value="activo">Activo</option>
                            <option value="completado">Completado</option>
                            <option value="pausado">Pausado</option>
                        </select>
                    </div>
                    
                    <label for="date-filter">Fecha:</label>
                    <div class="custom-select">
                        <select id="date-filter">
                            <option value="">Todas las fechas</option>
                            <option value="ultimo-mes">Último mes</option>
                            <option value="ultimos-3-meses">Últimos 3 meses</option>
                            <option value="ultimo-ano">Último año</option>
                        </select>
                    </div>
                </div>

                <!-- Tabla de Encuestas -->
                <table class="surveys-table">
                    <thead>
                        <tr>
                            <th>Encuesta</th>
                            <th>Estado</th>
                            <th>Fecha Inicio</th>
                            <th>Fecha Fin</th>
                            <th>Participantes</th>
                            <th>Progreso</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="clickable-row" onclick="window.location.href='resultados-nom035.html'">
                            <td>
                                <div>
                                    <strong>NOM 035 2024</strong><br>
                                    <small>NOM 035 - emocional</small>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-completed">completado</span>
                            </td>
                            <td>15 octubre 2024</td>
                            <td>15 noviembre 2024</td>
                            <td>150</td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 100%"></div>
                                </div>
                                <small>100%</small>
                            </td>
                        </tr>
                        <tr class="clickable-row" onclick="window.location.href='resultados-nom035-entorno.html'">
                            <td>
                                <div>
                                    <strong>NOM 035 2024</strong><br>
                                    <small>NOM 035 - entorno laboral</small>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-completed">completado</span>
                            </td>
                            <td>15 octubre 2024</td>
                            <td>15 noviembre 2024</td>
                            <td>150</td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 100%"></div>
                                </div>
                                <small>100%</small>
                            </td>
                        </tr>
                        <tr class="clickable-row" onclick="window.location.href='resultados-nom035.html'">
                            <td>
                                <div>
                                    <strong>Encuesta de Satisfacción</strong><br>
                                    <small>Evaluación general</small>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-completed">completado</span>
                            </td>
                            <td>1 enero 2024</td>
                            <td>31 enero 2024</td>
                            <td>200</td>
                            <td>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <small>85%</small>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script src="components/sidebar.js"></script>
    <script src="components/sub-nav.js"></script>
    <script src="components/tab-bar.js"></script>
    <script src="components/floating-menu.js"></script>
    <script src="components/profile-menu.js"></script>
    <script src="components/button.js"></script>

    <script>
        // ===== SISTEMA DE ONBOARDING NUEVO - DESDE CERO =====
        
        console.log('🚀 ===== INICIANDO SISTEMA DE ONBOARDING NUEVO =====');
        
        // Variables globales del onboarding
        let onboardingActive = false;
        let currentStep = 0;
        let onboardingSteps = [];
        
        // Configuración de pasos del onboarding
        const ONBOARDING_CONFIG = {
            steps: [
                {
                    id: 'welcome',
                    title: '¡Bienvenido!',
                    icon: '👋',
                    content: 'Te guiaremos paso a paso para que conozcas todas las funcionalidades del sistema de resultados NOM-035.',
                    target: null,
                    position: 'center'
                },
                {
                    id: 'emocional',
                    title: 'PASO 1: Resultados Emocionales',
                    icon: '💖',
                    content: 'Haz clic en esta fila para ver los resultados de la encuesta emocional. Aquí encontrarás análisis sobre el bienestar psicológico de los participantes.',
                    target: "tr:contains('emocional')",
                    position: 'top'
                },
                {
                    id: 'entorno',
                    title: 'PASO 2: Resultados de Entorno Laboral',
                    icon: '💼',
                    content: 'Ahora haz clic en esta fila para ver los resultados del entorno laboral. Aquí verás métricas sobre las condiciones de trabajo.',
                    target: "tr:contains('entorno laboral')",
                    position: 'top'
                },
                {
                    id: 'feedback',
                    title: 'PASO 3: Sistema de Feedback',
                    icon: '💬',
                    content: 'Usa este botón para dejar feedback en cualquier momento. Puedes comentar sobre lo que funciona bien, cosas que faltan, o mejoras que necesitas.',
                    target: '.feedback-trigger',
                    position: 'top'
                }
            ]
        };
        
        // ===== FUNCIONES PRINCIPALES DEL ONBOARDING =====
        
        // Inicializar onboarding
        function initOnboarding() {
            console.log('🎯 ===== INICIALIZANDO ONBOARDING =====');
            
            // Verificar si ya se completó
            const completed = localStorage.getItem('onboarding-completed');
            if (completed === 'true') {
                console.log('⚠️ Onboarding ya completado, omitiendo...');
                return;
            }
            
            // Configurar pasos
            onboardingSteps = ONBOARDING_CONFIG.steps;
            currentStep = 0;
            onboardingActive = true;
            
            console.log('✅ Onboarding inicializado');
            console.log('📊 Total de pasos:', onboardingSteps.length);
            
            // Esperar un poco para que se cargue la página
            setTimeout(() => {
                showCurrentStep();
            }, 1000);
        }
        
        // Mostrar paso actual
        function showCurrentStep() {
            console.log('🎯 ===== MOSTRANDO PASO ACTUAL =====');
            console.log('📍 Paso actual:', currentStep + 1, 'de', onboardingSteps.length);
            
            if (currentStep >= onboardingSteps.length) {
                console.log('✅ Onboarding completado');
                finishOnboarding();
                return;
            }
            
            const step = onboardingSteps[currentStep];
            console.log('📋 Paso configurado:', step);
            
            // Mostrar overlay
            const overlay = document.getElementById('onboardingOverlay');
            const spotlight = document.getElementById('onboardingSpotlight');
            const tooltip = document.getElementById('onboardingTooltip');
            
            console.log('🔍 Elementos del DOM:');
            console.log('- Overlay:', overlay);
            console.log('- Spotlight:', spotlight);
            console.log('- Tooltip:', tooltip);
            
            overlay.classList.add('show');
            console.log('✅ Overlay mostrado');
            
            // Buscar elemento objetivo
            let targetElement = null;
            if (step.target) {
                console.log('🔍 Buscando elemento objetivo:', step.target);
                targetElement = findTargetElement(step.target);
                console.log('🎯 Elemento encontrado:', targetElement);
            }
            
            if (targetElement) {
                console.log('📍 Destacando elemento...');
                highlightElement(targetElement, spotlight);
                console.log('📍 Posicionando tooltip...');
                positionTooltip(targetElement, tooltip, step.position);
                console.log('✅ Elemento destacado y tooltip posicionado');
            } else {
                console.log('📍 Mostrando en centro');
                positionTooltip(null, tooltip, 'center');
            }
            
            // Actualizar contenido del tooltip
            updateTooltipContent(step);
            
            console.log('✅ Paso mostrado correctamente');
        }
        
        // Buscar elemento objetivo
        function findTargetElement(selector) {
            console.log('🔍 ===== BUSCANDO ELEMENTO OBJETIVO =====');
            console.log('📍 Selector:', selector);
            
            // Buscar por texto en filas de tabla
            if (selector.includes('contains')) {
                const text = selector.match(/contains\('([^']+)'\)/)?.[1];
                if (text) {
                    console.log('🔍 Buscando por texto:', text);
                    const rows = document.querySelectorAll('tr');
                    for (let row of rows) {
                        if (row.textContent.toLowerCase().includes(text.toLowerCase())) {
                            console.log('✅ Elemento encontrado por texto');
                            return row;
                        }
                    }
                }
            }
            
            // Buscar por selector CSS
            const element = document.querySelector(selector);
            if (element) {
                console.log('✅ Elemento encontrado por selector');
                return element;
            }
            
            console.log('❌ Elemento no encontrado');
            return null;
        }
        
        // Destacar elemento
        function highlightElement(element, spotlight) {
            console.log('📍 ===== DESTACANDO ELEMENTO =====');
            const rect = element.getBoundingClientRect();
            console.log('📍 Posición del elemento:', rect);
            
            spotlight.style.left = (rect.left - 3) + 'px';
            spotlight.style.top = (rect.top - 3) + 'px';
            spotlight.style.width = (rect.width + 6) + 'px';
            spotlight.style.height = (rect.height + 6) + 'px';
            spotlight.style.display = 'block';
            
            console.log('✅ Elemento destacado');
        }
        
        // Posicionar tooltip
        function positionTooltip(targetElement, tooltip, position) {
            console.log('📍 ===== POSICIONANDO TOOLTIP =====');
            console.log('📍 Posición:', position);
            
            if (position === 'center') {
                tooltip.style.left = '50%';
                tooltip.style.top = '50%';
                tooltip.style.transform = 'translate(-50%, -50%)';
                document.getElementById('onboardingSpotlight').style.display = 'none';
                console.log('✅ Tooltip centrado');
            } else if (targetElement) {
                const rect = targetElement.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                
                console.log('📍 Rectángulo del elemento:', rect);
                console.log('📍 Rectángulo del tooltip:', tooltipRect);
                
                switch (position) {
                    case 'top':
                        tooltip.style.left = (rect.left + rect.width/2 - tooltipRect.width/2) + 'px';
                        tooltip.style.top = (rect.top - tooltipRect.height - 30) + 'px';
                        tooltip.style.transform = 'none';
                        console.log('✅ Tooltip posicionado arriba');
                        break;
                    case 'bottom':
                        tooltip.style.left = (rect.left + rect.width/2 - tooltipRect.width/2) + 'px';
                        tooltip.style.top = (rect.bottom + 20) + 'px';
                        tooltip.style.transform = 'none';
                        console.log('✅ Tooltip posicionado abajo');
                        break;
                    case 'left':
                        tooltip.style.left = (rect.left - tooltipRect.width - 20) + 'px';
                        tooltip.style.top = (rect.top + rect.height/2 - tooltipRect.height/2) + 'px';
                        tooltip.style.transform = 'none';
                        console.log('✅ Tooltip posicionado a la izquierda');
                        break;
                    case 'right':
                        tooltip.style.left = (rect.right + 20) + 'px';
                        tooltip.style.top = (rect.top + rect.height/2 - tooltipRect.height/2) + 'px';
                        tooltip.style.transform = 'none';
                        console.log('✅ Tooltip posicionado a la derecha');
                        break;
                }
            }
        }
        
        // Actualizar contenido del tooltip
        function updateTooltipContent(step) {
            console.log('📍 ===== ACTUALIZANDO CONTENIDO DEL TOOLTIP =====');
            
            document.getElementById('tooltipIcon').textContent = step.icon;
            document.getElementById('tooltipTitle').textContent = step.title;
            document.getElementById('tooltipContent').textContent = step.content;
            
            // Configurar botones
            const nextBtn = document.getElementById('tooltipNextBtn');
            const skipBtn = document.getElementById('tooltipSkipBtn');
            
            if (currentStep === onboardingSteps.length - 1) {
                nextBtn.textContent = 'Finalizar';
            } else {
                nextBtn.textContent = 'Siguiente';
            }
            
            console.log('✅ Contenido actualizado');
        }
        
        // Siguiente paso
        function nextOnboardingStep() {
            console.log('🔄 ===== SIGUIENTE PASO =====');
            console.log('📍 Paso actual antes:', currentStep);
            
            currentStep++;
            
            console.log('📍 Paso actual después:', currentStep);
            
            if (currentStep >= onboardingSteps.length) {
                console.log('✅ Onboarding completado');
                finishOnboarding();
            } else {
                showCurrentStep();
            }
        }
        
        // Omitir onboarding
        function skipOnboarding() {
            console.log('⏭️ ===== OMITIENDO ONBOARDING =====');
            finishOnboarding();
        }
        
        // Finalizar onboarding
        function finishOnboarding() {
            console.log('🏁 ===== FINALIZANDO ONBOARDING =====');
            
            const overlay = document.getElementById('onboardingOverlay');
            overlay.classList.remove('show');
            
            // Marcar como completado
            localStorage.setItem('onboarding-completed', 'true');
            onboardingActive = false;
            
            console.log('✅ Onboarding finalizado');
        }
        
        // Abrir modal de feedback
        function openFeedbackModal() {
            console.log('💬 ===== ABRIENDO MODAL DE FEEDBACK =====');
            alert('Sistema de feedback activado. En una implementación completa, aquí se abriría un modal para dejar comentarios.');
        }
        
        // ===== INICIALIZACIÓN =====
        
        // Esperar a que se cargue la página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📄 ===== DOM CONTENT LOADED =====');
            console.log('📍 Página encuestas.html cargada');
            console.log('📍 URL actual:', window.location.href);
            console.log('📍 Timestamp:', new Date().toISOString());
            
            // Esperar un poco más para que se carguen todos los componentes
            setTimeout(() => {
                console.log('🚀 ===== INICIANDO ONBOARDING DESDE DOM CONTENT LOADED =====');
                initOnboarding();
            }, 2000);
        });
        
        // También iniciar desde window.load por si acaso
        window.addEventListener('load', function() {
            console.log('🔄 ===== WINDOW LOAD EVENT =====');
            console.log('📍 Ventana completamente cargada');
            
            if (!onboardingActive) {
                console.log('🚀 ===== INICIANDO ONBOARDING DESDE WINDOW LOAD =====');
                initOnboarding();
            }
        });
        
        console.log('✅ ===== SISTEMA DE ONBOARDING CARGADO =====');
    </script>
</body>
</html>
